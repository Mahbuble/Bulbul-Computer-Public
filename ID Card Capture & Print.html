<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ID Card Pro | বুলবুল কম্পিউটার</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.min.css">
    <style>
        :root { --primary: #007bff; --success: #28a745; --danger: #dc3545; --warning: #ffc107; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f0f2f5; padding: 15px; text-align: center; color: #333; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .upload-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; margin-top: 20px; }
        .box { border: 2px dashed #ccd1d9; padding: 20px; border-radius: 12px; background: #fff; position: relative; }
        .box:hover { border-color: var(--primary); }
        .crop-container { width: 100%; height: 280px; margin-top: 10px; background: #fafafa; border-radius: 8px; overflow: hidden; }
        .controls { margin-top: 15px; text-align: left; background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #eee; }
        .controls label { font-size: 13px; font-weight: 600; display: block; margin-bottom: 5px; color: #444; }
        .controls input { width: 100%; margin-bottom: 12px; }
        
        .btn-group { display: flex; gap: 5px; margin-top: 10px; }
        .btn { padding: 12px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; flex: 1; font-size: 14px; }
        .btn-upload { background: var(--primary); color: white; margin-bottom: 10px; width: 100%; }
        .btn-rotate { background: #6c757d; color: white; }
        .btn-crop { background: var(--warning); color: #000; }
        .btn-print { background: var(--success); color: white; padding: 15px 60px; font-size: 18px; border-radius: 50px; margin-top: 30px; }
        .btn-reset { background: var(--danger); color: white; padding: 15px 30px; font-size: 18px; border-radius: 50px; margin-top: 30px; }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.15); }

        footer { margin-top: 50px; padding: 20px; border-top: 1px solid #eee; color: #666; }
        .footer-brand { color: #2c3e50; font-weight: bold; font-size: 18px; margin-bottom: 5px; }

        #printArea { display: none; }

        @media print {
            body { background: white; padding: 0; }
            .no-print { display: none !important; }
            #printArea { display: flex !important; flex-direction: column; align-items: center; gap: 5mm; padding-top: 10mm; }
            .final-id-img { 
                width: 85.6mm; height: 53.98mm; 
                border: 1px solid #ddd; 
                border-radius: 3.2mm; /* কার্ডের মত গোল কোণা */
                object-fit: cover; 
                page-break-inside: avoid;
                margin-bottom: 5mm;
            }
        }
    </style>
</head>
<body>

<div class="container no-print">
    <h2 style="color: #2c3e50; margin: 0;">ID কার্ড এডিট ও প্রিন্ট টুল</h2>
    <p style="color: #7f8c8d; margin: 5px 0 20px 0;">বুলবুল কম্পিউটার • স্মার্ট এডিশন</p>
    
    <div class="upload-grid">
        <div class="box">
            <strong style="color: var(--primary);">১. সামনের অংশ (Front Side)</strong>
            <input type="file" id="inputFront" accept="image/*" class="btn-upload">
            <div id="cropFront" class="crop-container"></div>
            
            <div class="controls">
                <label>উজ্জ্বলতা (Brightness)</label>
                <input type="range" id="brightFront" min="50" max="150" value="100" oninput="updateFilters('front')">
                <label>কন্ট্রাস্ট (Contrast)</label>
                <input type="range" id="contrastFront" min="50" max="150" value="100" oninput="updateFilters('front')">
                <div class="btn-group">
                    <button class="btn btn-rotate" onclick="rotate('front', -90)">বাম দিকে ঘোরান</button>
                    <button class="btn btn-rotate" onclick="rotate('front', 90)">ডান দিকে ঘোরান</button>
                </div>
            </div>
            <button class="btn btn-crop" onclick="saveCrop('front')">ক্রপ ও কনফার্ম করুন</button>
        </div>

        <div class="box">
            <strong style="color: var(--primary);">২. পেছনের অংশ (Back Side)</strong>
            <input type="file" id="inputBack" accept="image/*" class="btn-upload">
            <div id="cropBack" class="crop-container"></div>
            
            <div class="controls">
                <label>উজ্জ্বলতা (Brightness)</label>
                <input type="range" id="brightBack" min="50" max="150" value="100" oninput="updateFilters('back')">
                <label>কন্ট্রাস্ট (Contrast)</label>
                <input type="range" id="contrastBack" min="50" max="150" value="100" oninput="updateFilters('back')">
                <div class="btn-group">
                    <button class="btn btn-rotate" onclick="rotate('back', -90)">বাম দিকে ঘোরান</button>
                    <button class="btn btn-rotate" onclick="rotate('back', 90)">ডান দিকে ঘোরান</button>
                </div>
            </div>
            <button class="btn btn-crop" onclick="saveCrop('back')">ক্রপ ও কনফার্ম করুন</button>
        </div>
    </div>

    <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
        <button class="btn btn-reset" onclick="resetAll()">রিসেট করুন</button>
        <button class="btn btn-print" onclick="uploadAndPrint()">প্রিন্ট করুন</button>
    </div>

    <footer>
        <div class="footer-brand">বুলবুল কম্পিউটার</div>
        <div>যোগাযোগ: <a href="tel:01712659086" style="color: var(--primary); text-decoration: none; font-weight: bold;">01712659086</a></div>
        <div style="font-size: 13px; margin-top: 5px;">রুপালী ব্যাংকের নীচে, বাগআঁচড়া বাজার, শার্শা, যশোর।</div>
    </footer>
</div>

<div id="printArea">
    <img id="resFront" class="final-id-img" style="display:none;">
    <img id="resBack" class="final-id-img" style="display:none;">
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.min.js"></script>
<script>
    let cropperFront, cropperBack;
    let blobFront = null, blobBack = null;
    let frontLoaded = false;

    const cropOptions = {
        viewport: { width: 280, height: 176, type: 'square' }, 
        boundary: { width: 320, height: 240 },
        showZoomer: true,
        enableOrientation: true // ঘোরানোর জন্য এটি প্রয়োজন
    };

    function initCroppers() {
        cropperFront = new Croppie(document.getElementById('cropFront'), cropOptions);
        cropperBack = new Croppie(document.getElementById('cropBack'), cropOptions);
    }
    initCroppers();

    function rotate(side, deg) {
        if(side === 'front') cropperFront.rotate(deg);
        else cropperBack.rotate(deg);
    }

    function updateFilters(side) {
        const sideCap = side.charAt(0).toUpperCase() + side.slice(1);
        const b = document.getElementById(`bright${sideCap}`).value;
        const c = document.getElementById(`contrast${sideCap}`).value;
        const img = document.querySelector(`#crop${sideCap} .cr-image`);
        if (img) img.style.filter = `brightness(${b}%) contrast(${c}%)`;
    }

    function handleFile(input, cropper, side) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                cropper.bind({ url: e.target.result }).then(() => updateFilters(side));
                if(side === 'front') frontLoaded = true;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    document.getElementById('inputFront').onchange = function() { handleFile(this, cropperFront, 'front'); };
    document.getElementById('inputBack').onchange = function() { handleFile(this, cropperBack, 'back'); };

    // ক্লিপবোর্ড থেকে ইমেজ পেস্ট সাপোর্ট
    document.addEventListener('paste', function (e) {
        const item = Array.from(e.clipboardData.items).find(x => x.kind === 'file');
        if (item) {
            const blob = item.getAsFile();
            const reader = new FileReader();
            reader.onload = function (event) {
                if (!frontLoaded) {
                    cropperFront.bind({ url: event.target.result }).then(() => updateFilters('front'));
                    frontLoaded = true;
                } else {
                    cropperBack.bind({ url: event.target.result }).then(() => updateFilters('back'));
                }
            };
            reader.readAsDataURL(blob);
        }
    });

    function saveCrop(side) {
        const sideCap = side.charAt(0).toUpperCase() + side.slice(1);
        const cropper = (side === 'front') ? cropperFront : cropperBack;
        const b = document.getElementById(`bright${sideCap}`).value;
        const c = document.getElementById(`contrast${sideCap}`).value;

        cropper.result({ 
            type: 'canvas', 
            size: { width: 1011, height: 638 },
            format: 'jpeg',
            quality: 1
        }).then(canvasData => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.filter = `brightness(${b}%) contrast(${c}%)`;
                ctx.drawImage(img, 0, 0);
                canvas.toBlob(blob => {
                    if(side === 'front') {
                        blobFront = blob;
                        document.getElementById('resFront').src = URL.createObjectURL(blob);
                        document.getElementById('resFront').style.display = 'block';
                    } else {
                        blobBack = blob;
                        document.getElementById('resBack').src = URL.createObjectURL(blob);
                        document.getElementById('resBack').style.display = 'block';
                    }
                    alert(sideCap + " সাইড সফলভাবে সেভ হয়েছে!");
                }, 'image/jpeg', 0.95);
            };
            img.src = canvasData;
        });
    }

    function resetAll() {
        if(confirm("সব ডাটা মুছে নতুন করে শুরু করতে চান?")) location.reload();
    }

    function uploadAndPrint() {
        if (!blobFront && !blobBack) {
            alert("কমপক্ষে একটি সাইড ক্রপ করে কনফার্ম করুন!");
            return;
        }
        window.print();
    }
</script>
</body>
</html>